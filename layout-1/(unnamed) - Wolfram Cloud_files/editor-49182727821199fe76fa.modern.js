(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{GUYioj:function(t,e,n){},RdFcoL:function(t,e,n){"use strict";n.r(e);var s=n("MVZn7m"),o=n.n(s),i=n("U+yc2h"),r=n.n(i),a=n("F/us1n"),l=n.n(a),c=n("EVdnBj"),h=n.n(c),u=n("9lTWn6"),d=n.n(u),p=n("3n9vtm"),f=n("q1tIBJ"),g=n("i8i4Lr"),m=n.n(g),x=(n("vzNxhm"),n("KdFbCq"),n("GUYioj"),n("4GILXw"),n("eHqigM")),y=n("aEFwcg"),C=n("+PQVfF"),k=n("+fbQp0");function b(t,e){return t.line===e.line&&t.ch===e.ch}function v(t,e){return t.getTokenAtWithoutState({line:e.line,ch:e.ch})}function w(t,e,n){return t&&"bracket-left"===t.type?e:e?n&&e.parent&&n.find(e.parent,!0):null}function S(t,e){if(!t||!e)return null;if(t===e)return t;let n=t;for(;n;){let t=e;for(;t;){if(t.id===n.id)return t;t=t.parent}n=n.parent}return null}function E(t){const e=t.getCursor("start"),n=t.getCursor("end"),s=e.line===n.line&&e.ch+1===n.ch;0===n.ch&&0===n.line&&++n.ch;const o=b(e,n)||s||1===n.ch&&0===n.line;let i="";if(o){const e=t.getLineHandle(n.line);n.ch>=1&&("|"!==(i=e.text.charAt(n.ch-1))&&">"!==i||n.ch>=2&&(i=e.text.charAt(n.ch-2)+i))}const r=v(t,e),a=v(t,n);if(r&&a&&a.expr){const e=k.a(t,n.line);let l=e&&e.find(r.expr,!0),c=e&&e.find(a.expr,!0),h=a.token;const u=c;let d=S(l=w(r.token,l,e),c=w(a.token,c,e));d&&(d=e.find(d,!0));let p=!1;const f=[];if(d){let t=d;for(;t&&"["!==t.op;)t=t.parent;t&&(t=e.find(t,!0)),t&&t.head&&(t.head.walkTokens(t=>{f.push(t)}),t.token&&f.push(t.token),t.openingToken&&f.push(t.openingToken))}return o&&u&&h&&"comment"!==h.type&&"char-name"!==h.type&&(C.j.test(i)||C.u.test(i)||C.i.test(i)||C.t.test(i))&&(C.q.test(i)?u.openingToken&&(h=u.openingToken):u.openingToken&&(h=u.token),p=h.matchingToken),p?{from:h,isSelected:s,to:h.matchingToken,match:!0,funcTokens:f}:{match:!1,funcTokens:f}}return null}function T(t,e){const n=E(t);if(!n)return null;const s="highlight-matching";n.match&&(n.isSelected&&n.from.addClass("highlight-matching-selected"),n.from.addClass(s),n.to.addClass(s)),l.a.each(n.funcTokens,t=>{t.addClass("highlight-function")});const o=()=>{t.operation(()=>{n.match&&(n.isSelected&&n.from.removeClass("highlight-matching-selected"),n.from.removeClass(s),n.to.removeClass(s)),l.a.each(n.funcTokens,t=>{t.removeClass("highlight-function")})})};return e?(setTimeout(o,8e3),null):o}function A(t){t.operation(()=>{t.currentlyHighlighted&&(t.currentlyHighlighted(),t.currentlyHighlighted=null),t.currentlyHighlighted=T(t,!1)})}y.a.defineOption("mathematicaMatchBrackets",!1,(t,e)=>{e?(t.on("lineparsed",A),t.on("cursorActivity",A),t.on("linehighlighted",A)):(t.off("lineparsed",A),t.off("cursorActivity",A),t.off("linehighlighted",A))}),y.a.defineExtension("mathematicaMatchBrackets",function(){T(this,!0)}),y.a.defineExtension("mathematicaFindMatchingBracket",function(){return E(this)});var B=n("a7Cy1t"),K=n("Cmf6vw"),P=n("9mIgL/"),O=n("YlGCNT"),R=n("vPBHHJ");const L=/\d/,M=Object(B.a)({matchStart:!0}),N=/^([-+]?\d*\.?\d+)(?:[eE]([-+]?\d+))?$/,D=Object(B.b)({matchStart:!0}),F="­",W="‐",I="‑",H=["ⅿ","ⅾ","ⅽ","ⅼ","ⅹ","ⅴ","ⅰ","Ⅿ","Ⅾ","Ⅽ","Ⅼ","Ⅹ","Ⅴ","Ⅰ","m","d","c","l","x","v","i","M","D","C","L","X","V","I"],_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0];function z(t){return"-"===t||t===W||t===I}function j(t,e,n){const s=!1,o=!!(e&(O.a.All|O.a.Hyphen)),i=!!(e&(O.a.All|O.a.InternalCapitals)),r=!!(e&(O.a.All|O.a.Underscore)),a=t.charCodeAt();if(160===a||8211===a||8212===a||8213===a||8482===a)return!0;if(z(t))return o;if(t===F)return!!s&&o;if("_"===t)return r;if(8217===a)return!1;if(187===a||171===a)return!0;if(63328===a)return!1;if(a>=384&&a<1024||a>=1280)return!0;if(a>127){const{isOperator:t}=C.d.get(a)||{};return!!t}if(_[a]){if(!i)return!1;if(!P.a.isUpperCase(t))return n.lowerCasePresent=!0,!1;if(!n.lowerCasePresent)return!1}return!0}function U(t,e){if(e&R.a.SingleCharacterWords&&1===t.length)return!0;if(e&R.a.Numbers&&N.test(t))return!0;if(e&R.a.WordsWithNumbers&&t.search(L)>=0)return!0;if(e&R.a.WordsInAllCaps){let e=!0;for(const n of t)if(!P.a.isUpperCase(n)){e=!1;break}if(e)return!0}if(e&R.a.RomanNumerals){let e=!0;for(const n of t)if(H.indexOf(n)<0){e=!1;break}if(e)return!0}if(e&R.a.HyphenatedWords)for(const e of t)if(z(e)||e===F)return!0;if(e&R.a.WordsWithUnderscores&&t.indexOf("_")>=0)return!0;if(e&R.a.WordsWithInternalCapitals){let e=!0;for(const n of t){if(P.a.isUpperCase(n)&&!e)return!0;e=!1}}return!1}function q(t,e,n){const{getCellSpellingOptions:s}=t,{alwaysSkip:o,alwaysStop:i,wordSplitting:r}=s&&s()||{},a=o&~i;return{startState:()=>({}),copyState:t=>({}),transformInput:K.j,token:function(t){if(a&R.a.WordsInURL&&(t.match(M)||t.match(D)))return"url";const e={lowerCasePresent:!1};if(t.eatWhile(t=>j(t,r,e))){const e=t.current(),n="\\[",s=e.match(/^(.*)(\uf764\s?)/);if(s){const[,e,n]=s;if(e)t.backUp(n.length);else if(t.eol()||t.match(/^\w+\uf764?/))return"char-esc"}else if(e.endsWith(n))if(e!==n)t.backUp(n.length);else if(t.eol()||t.match(/^[A-Z]\w*\]?/))return"char-name";return"delimiter"}return e.lowerCasePresent=!1,t.eatWhile(t=>!j(t,r,e))?U(t.current(),a)?"text":"spellchecked":null}}}y.a.defineMode("mathematica-text",q);n("YcvF1R");var V=n("fpt3M3"),G=n("khsRcz"),$=n("junVAP"),J=n("oJz7gR"),Y=n("gqboo+");const Z=K.e;function Q(t,e,n,s){const o=t.text,i=t.boxOptions;let r;if(i&&i.forEach(t=>{let{boxName:e,options:i,styleNames:r}=t;const a={from:s,to:{line:s.line,ch:s.ch+o.length},marker:{boxOptions:{boxName:e,options:i,styleNames:r}}};n.push(a)}),o.indexOf("\n")>-1){const t=o.length;let n;for(n=0;n<t;n++)"\n"===o[n]?e.push(""):e[r=e.length-1]+=o[n]}else e[r=e.length-1]+=o}function X(t,e,n,s){let{box:o}=t;const i=Z;e[e.length-1]+=i,n.push({from:s,to:{line:s.line,ch:s.ch+i.length},marker:{isInlineCell:!0,replacedWithBox:o}})}function tt(t,e){const n=e.length-1,s=e[n];return{line:n+t.line,ch:s.length+t.ch}}function et(t,e,n,s,o){const i=s||[""],r=n||{line:0,ch:0};if(!t)return Y.a.resolve("");const a=[];return(Array.isArray(t)?t:[t]).forEach(t=>{const e=t instanceof J.a?t:J.a.fromExpr(t),n=o.editor.getContext(),s=e.linearize({context:n});a.push(s)}),Y.a.all(a).then(t=>(t.forEach(t=>{t.forEach(t=>{const n=tt(r,i);"text"===t.type?Q(t,i,e,n):"box"===t.type&&X(t,i,e,n)})}),i.join("\n")))}function nt(t){let{text:e,markers:n}=t;return e===Z&&1===n.length&&0===n[0].from.ch&&1===n[0].to.ch&&!!n[0].marker.replacedWithBox}var st=n("Lyt2Gx"),ot=(n("W/ttjn"),n("GDye+G")),it=n("72ZVmy"),rt=n("xkfKkX"),at=n("qGwtCP"),lt=n("q9a/O4"),ct=n("w+H+yY"),ht=n("mh5zGw"),ut=n("W1VMfd"),dt=(n("qvtAvJ"),n("cb5p9p")),pt=n("l7Lv1m"),ft=n("6K8QBq"),gt=n("z9ZhaO"),mt=n("0343Lw"),xt=n("RPB45i"),yt=n("UKk0w1");class TimeDelay_TimeDelay{constructor(t){this.promise=null,this.timeReset=0,this.delay=t}onTimeout(t){const e=this.delay-(Date.now()-this.timeReset);e>0?setTimeout(()=>this.onTimeout(t),e):(this.promise=null,this.timeReset=0,t())}reset(){this.promise||(this.promise=new Y.a(t=>{setTimeout(()=>this.onTimeout(t),this.delay)})),this.timeReset=Date.now()}wait(){return this.promise}}var Ct,kt,bt,vt=n("imcRL3");n("fqtNJs");n.d(e,"default",function(){return Ht});const wt=p.a("editor"),St=Object(ct.a)(()=>n.e(47).then(n.bind(null,"IsxU/e")));function Et(t){t.inclusiveRight=!(!t.boxOptions||t.replacedWithBox)}function Tt(t,e,n,s,o,i){if(!t)return Y.a.resolve(null);const r=[];return et(e,r,n,null,{editor:o}).then(e=>{for(const t of r){const{marker:e}=t;Et(e)}return t.replaceRangeAndMarkers(e,n,s||n,r,i)})}function At(t,e,n,s,o,i){if(!t)return;const r=0===P.a.cmpPos(e,n),a=n.line-e.line+1;let l=0;t.view.doc.iter(e.line,n.line+1,t=>{const c=o(t);if(c)for(const o of c){const i=l>0?0:e.ch,a=l<n.line-e.line?t.text.length:n.ch;if((null===o.from||o.from<a)&&(null===o.to||(r?o.to>=i:o.to>i))&&!1===s(o,i,a,t,e.line+l))break}if(++l,i){i(l===a)}})}function Bt(t,e,n,s,o){At(t,e,n,(t,e,n,o,i)=>s(t.marker,t.from,t.to,i),t=>t.markedSpans,o)}function Kt(t,e,n,s,o){At(t,e,n,s,t=>t.elements||[],o)}function Pt(t,e){if(!t)return{start:{line:0,ch:0},end:{line:0,ch:0}};let n,s;return e?(n={line:0,ch:0},s=Ot(t)):(n=t.getCursor("start"),s=t.getCursor("end")),{start:n,end:s}}function Ot(t){const e=t.lineCount();return{line:e-1,ch:t.getLine(e-1).length}}function Rt(t,e){return t.line<e.line||t.line===e.line&&t.ch<=e.ch}function Lt(t,e){return Rt(e.start,t.start)?Rt(t.end,e.end)?[]:Rt(t.start,e.end)?[{start:t.start,end:e.end}]:[t]:Rt(t.end,e.start)?[t]:Rt(e.end,t.end)?[{start:t.start,end:e.start},{start:e.end,end:t.end}]:[{start:t.start,end:e.start}]}function Mt(t,e,n,s,o){let i=0,r=t.length;return e===o.start.line&&n<o.start.ch&&(i=o.start.ch-n),e===o.end.line&&s>o.end.ch&&(r=t.length-(s-o.end.ch)),t.substr(i,r-i)}function Nt(t,e,n){const s=[];return l.a.each(t,(t,o)=>{const i=e(t,o);l.a.any(s,t=>n(t,i))||s.push(i)}),s}function Dt(t,e,n,s,o){const i={};let r=0,a=!1;Kt(t,e,n,(t,e,n,o,a)=>{if(++r,!t.isWidget){if("space"!==t.token.type){const e=(t.token.getCSS?t.token.getCSS():{}).color;e&&(i.FontColor=i.FontColor||[],i.FontColor.push({range:r,value:e}))}t.boxOptions&&l.a.each(t.boxOptions,t=>{if(t.boxName===s){const e=t.options;l.a.each(e,(t,e)=>{i[e]=i[e]||[],i[e].push({range:r,value:t})})}})}},()=>{0===r&&(a=!0,r=1)});const c={};return l.a.each(o,(t,e)=>{i[e]||(i[e]=a?{range:r,value:o[e]}:[])}),l.a.each(i,(t,e)=>{const n=[];for(let t=0;t<r;++t)n[t]=o[e]||null;l.a.each(t,t=>{n[t.range-1]=t.value});const s=Nt(n,l.a.identity,(t,e)=>t===e||ot.isExpr(t)&&ot.isExpr(e)&&t.sameQ(e));c[e]=l.a.without(s,null)}),c}function Ft(t,e,n,s){const o={element:null,from:null,to:null};function i(t,e,n){o.element=t,o.from=e,o.to=n}return t?(e(null,n,(t,e,n)=>{i(t,e,n)}),o.element||e(n,null,(t,e,n)=>{i(t,e,n)})):(e(s,null,(t,e,n)=>(i(t,e,n),!1)),o.element||e(null,s,(t,e,n)=>(i(t,e,n),!1))),o}function Wt(t,e,n,s,o,i){function r(t,e){return{line:t,ch:e}}function a(e,o,i){Bt(t,e||n,o||s,(t,e,n,s)=>{const o=t.replacedWithBox;return o&&o.tag&&"Placeholder"===o.tag.toStringValue()?i(t,r(s,n),r(s,e)):null})}const l=Ft(e,a,o,i);l.element&&t.setSelection(l.from,l.to)}function It(t,e){wt.debug("Creating text box",t,"for line element",e);let n=ot.string(t);if(e.boxOptions)for(let t=e.boxOptions.length-1;t>=0;--t){const s=e.boxOptions[t],o=[n,...l.a.map(s.options,(t,e)=>ot.rule(e,t)),...l.a.map(s.styleNames,t=>ot.string(t))];o.length>1&&(n=ot.expression(s.boxName,o))}return n}let Ht=(Ct=Object(ft.b)(),kt=Object(ft.b)(),bt=class Editor extends x.a{constructor(){super(...arguments),this.spellcheckDelay=null,this.getCellSpellingOptions=(()=>({alwaysSkip:this.cell&&this.cell.options.resolve("SpellingOptionsAlwaysSkip")||0,alwaysStop:this.cell&&this.cell.options.resolve("SpellingOptionsAlwaysStop")||0,wordSplitting:this.cell&&this.cell.options.resolve("SpellingOptionsWordSplitting")||0})),this.onCursorActivity=((t,e)=>{const{onCursorActivity:n}=this.options,s=e&&e.origin||null;"function-template"===s||"symbol-completion"===s||!this.contentAssist||this.contentAssist.renderFunctionTemplates(this,!0,!0)||("delete"===s||"input"===s)&&this.contentAssist.renderSymbolCompletions(this,!0)||this.contentAssist.unmount(),"input"!==s&&this.cursorBox&&(this.cursorBox.onCursorLeaveAfterRenderAtCursor(),this.cursorBox=null),n&&n(this)}),this.onEditorChange=((t,e)=>{const n=e&&e.origin||null,s="eval-in-place-edit"!==n;this.afterChange({shouldGrayDownCells:s}),"symbol-completion"===n&&this.contentAssist&&!this.contentAssist.renderFunctionTemplates(this,!1,!0)&&this.contentAssist.unmount(),this.isChangeFromKeydown?this.setPopupTokenActive():this.removePopupToken(),this.isChangeFromKeydown=!1}),this.onEditorHistoryAction=(()=>{const t=this.notebook;t&&this.options.useNotebookUndoHistory&&t.history.add({redo:()=>{this.editor&&this.editor.execCommand("redo")},undo:()=>{this.editor&&this.editor.execCommand("undo")}})}),this.onFocusIn=(t=>{let{relatedTarget:e}=t;!this.contentAssist||e instanceof Element&&this.contentAssist.contains(e)||this.contentAssist.renderFunctionTemplates(this,!0,!0)}),this.onFocusOut=(t=>{let{relatedTarget:e}=t;!this.contentAssist||e instanceof Element&&this.contentAssist.contains(e)||this.contentAssist.unmount()}),this.onKeyEvent=((t,e)=>{const n=this.options,s=this;let o,i=!1,r=!1,a=!1,c=!1;function h(){return e.stop(),i=!0,!0}function u(){return r=!0,!0}function p(){return a=!0,!0}function f(){return c=!0,!0}function g(t){return l.a.extend({},t,{stop:h,stopEditorProcessing:u,stopDefault:p,stopKeyBinding:f})}if("keydown"===e.type){if(o=st.b(e),s.handleKeydown(o))return e.stop(),!0;if(n.onKeyDown){if(n.onKeyDown.call(s,g(e)),i)return!0;if(c)return e.preventDefault(),!0;a&&e.preventDefault()}}return"keypress"===e.type&&(o=st.b(e),s.handleKeypress(o.text,o))?(e.stop(),!0):!("keypress"!==e.type||!n.onKeyPress||(n.onKeyPress.call(s,g(e)),!i))||(!("keyup"!==e.type||!n.onKeyUp||(n.onKeyUp.call(s,g(e)),!i))||("keydown"===e.type&&this.isMathematicaCode&&(t.flushInput(),13!==e.which||e.shiftKey||e.ctrlKey||e.metaKey?8!==e.which&&(this.returnKeyCount=0):(++this.returnKeyCount,this.contentAssist&&this.returnKeyCount>=4&&setTimeout(()=>{d()(this.contentAssist),this.contentAssist.renderReturnKeyMessage(this)},50))),!!$.m(e)||(!(!n.cellInteraction||!this.handleNotebookKeys(e,h))||("keydown"===e.type&&(P.a.handleKeyboardEvent(e,"Ctrl+shift+K",()=>(this.contentAssist&&this.contentAssist.renderFunctionTemplates(this,!1,!1),h())),P.a.handleKeyboardEvent(e,"Ctrl+K",()=>(this.contentAssist&&this.contentAssist.renderSymbolCompletions(this,!1),h()))),s.readOnly||"keydown"!==e.type||27!==e.which?("keydown"===e.type&&e.which>=48&&!e.metaKey&&!e.ctrlKey&&(this.isChangeFromKeydown=!0),"keydown"===e.type&&this.removePopupToken(),!!r):(t.replaceSelection(""),t.setSelection(t.getCursor("end")),!0)))))})}initialize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.readOnly=e.readOnly,this.options=e;const s=this.notebook=e.notebook||null;this.cell=e.cell||null,this.maxWidth=e.maxWidth||null,this.isMathematicaCode=e.isMathematicaCode;const i=e.disableCopyPaste||!1;this.returnKeyCount=0,this.popupToken=null,this.isPopupTokenActive=!1,this.clearPopupTimer=null,this.isChangeFromKeydown=!1,this.isExternalChange=!1,this.clipboardHandler={copy:t=>{let{useWholeCell:e=!1}=t;return!i&&this.getCopyData(e)},paste:t=>!i&&(!this.readOnly&&void Object(ut.b)(t,s).then(t=>{this.pasteData(t)})),restoreFocus:()=>{this.focus()}};const r=s&&e.useNotebookUndoHistory?st.d({"Cmd-Z":()=>s.history.undo(),"Shift-Cmd-Z":()=>s.history.redo(),"Cmd-Y":()=>s.history.redo()}):{};this.mathematicaKeys=o()({},r,{Tab:t=>this.tabKeyPress(t),"Shift-Tab":t=>this.tabKeyPress(t,!0)}),this.textKeys=o()({},r);const a=h()(t||document.createElement("div"));this.container=a.get(0),this.processedContent={text:"",markers:[]},this.setState({content:n}),this.placeholderNode=null,this.didLinesUnmount=!1,this._setContentAssist(null)}defaults(){return{content:null}}doPrepare(){const t=this.get("content");let e;if(t){const n=[];e=et(t,n,null,null,{editor:this}).then(t=>({text:t,markers:n}))}else e=Y.a.resolve(this.processedContent);return this.isMathematicaCode?Y.a.all([e,mt.c()]).then(t=>{let[e,n]=t;return{processedContent:e,symdata:n}}):e.then(t=>({processedContent:t}))}createCodeMirror(t,e){let{text:n,markers:s}=t;const{options:o,isMathematicaCode:i}=this,r={lineWrapping:!o.noLineWrapping,value:n||"",mode:i?"mathematica":"mathematica-text",mathematicaMatchBrackets:i,theme:i?"mathematica":"text",extraScrollerWidth:0,getCellSpellingOptions:i?null:this.getCellSpellingOptions,onSymbol:G.a.onSymbol,symdata:e,enableTextTransformations:!0,noCachedPosition:o.noCachedPosition,renderLine:o.plainText?null:this.doRenderLine.bind(this),reflowLine:o.plainText?null:this.reflowLine.bind(this),onRender:this.onRender.bind(this),shouldIgnoreEvent:this.shouldIgnoreEditorEvent.bind(this),isMobileView:this.notebook&&this.notebook.get("isMobileView"),inputParent:this.notebook?this.notebook.getNode():null,autofocus:o.autofocus,workDelay:50,dragDrop:!1,dragDropText:!1,disableScroll:!0,avoidMeasurement:!o.plainText,stopKeyEvents:o.stopKeyEvents,flattenSpans:!1};o.numericInput&&(r.acceptContent=(t=>/^-?[0-9]*\.?[0-9]*$/.test(t))),r.customCopyPaste=!0,r.onCopy=r.onCut=r.onPaste=(t=>{$.l(t)}),r.onKeyEvent=this.onKeyEvent,this.readOnly&&(r.readOnly=!0),r.markers=[],l.a.each(s,t=>{Et(t.marker),r.markers.push({from:t.from,to:t.to,marker:t.marker})}),this.editor=new y.a(this.container,r);const a=this.editor;a.removeKeyMap(this.mathematicaKeys),a.removeKeyMap(this.textKeys),i?a.addKeyMap(this.mathematicaKeys):a.addKeyMap(this.textKeys),a.on("change",this.onEditorChange),a.on("cursorActivity",this.onCursorActivity),a.on("focusin",this.onFocusIn),a.on("focusout",this.onFocusOut),a.on("focus",()=>{$.a(this.clipboardHandler),o.onFocus&&o.onFocus(this)}),a.on("blur",()=>{this.cursorBox&&(this.cursorBox.onCursorLeaveAfterRenderAtCursor(),this.cursorBox=null),this.returnKeyCount=0,$.j(this.clipboardHandler),o.onBlur&&o.onBlur(this)}),a.on("pre-change",()=>{if(!this.spellcheckDelay){const t=this.cell&&this.cell.options.resolve("SpellingOptionsAutoSpellCheckDelay")||0;this.spellcheckDelay=new TimeDelay_TimeDelay(1e3*t)}this.spellcheckDelay.reset()}),a.on("popuptoken",this.setPopupToken.bind(this)),a.on("historyAction",this.onEditorHistoryAction),this._setContentAssist(null),o.autocomplete&&St().then(t=>{this._setContentAssist(t)}).then(()=>{d()(this.contentAssist),i?this.contentAssist.enableTooltips(this):this.contentAssist.disableTooltips(this)})}shouldIgnoreEditorEvent(t,e){if(t&&t.suppressPressEventsForEditor)return!0;let n=t.target;for(;n&&n instanceof Element;){if(n.classList.contains("editor-inset")||n.classList.contains("hyperlink-button-box"))return!0;if(n.classList.contains("select-on-click")){if(e){const n=e.posFromMouse(t),s=e.getLine(n.line);if(s){let t=n.ch,o=n.ch;!1===n.after||o===s.length?t--:o++,e.setSelection({line:n.line,ch:t},{line:n.line,ch:o}),window.setTimeout(()=>{e.focus(!0)},0)}}return!0}if(n===this.container)break;n=n.parentNode}return!1}removePopupToken(){this.popupToken&&this.popupToken.removeClass("popup"),this.popupToken=null,this.isPopupTokenActive=!1}setPopupToken(t,e){window.clearTimeout(this.clearPopupTimer),this.popupToken&&this.popupToken.removeClass("popup"),this.popupToken=e,this.isPopupTokenActive&&this.popupToken.addClass("popup")}setPopupTokenActive(){window.clearTimeout(this.clearPopupTimer),this.isPopupTokenActive=!0,this.popupToken&&this.popupToken.addClass("popup"),this.clearPopupTimer=window.setTimeout(this.removePopupToken.bind(this),600)}handleNotebookKeys(t,e){const n=this.editor,s=this.options.cellInteraction,{shiftKey:o,type:i,which:r}=t;if("keydown"===i&&this.contentAssist&&this.contentAssist.handleKey(t))return e();if("keydown"===i&&!o&&s&&"boolean"!=typeof s&&n){const t=s;if(38===r){const{top:s}=n.cursorCoords(!0,"local");if(this.isStartSelected()||s<3)return t.navigateUp(this),e()}if(40===r){const{bottom:s}=n.cursorCoords(!1,"local");if(this.isEndSelected()||s>=n.view.doc.height-3)return t.navigateDown(this),e()}if(37===r){const s=n.getCursor("start");if(0===s.line&&0===s.ch&&!n.somethingSelected())return t.navigateLeft(this),e()}if(39===r){const s=n.getCursor("end"),o=Ot(n);if(s.line===o.line&&s.ch===o.ch&&!n.somethingSelected())return t.navigateRight(this),e()}}return!1}getRenderOptions(t,e){const n=t.getLineNumber(e),s=t.getLineHandle(n-1),o=t.lineCount(),i=n===o-1&&this.inlineContentsBox?this.inlineContentsBox:null;return{width:this.maxWidth,indentation:s?s.indentationBelow:0,afterFirstLine:n>0,beforeLastLine:n<o-1,contentPadding:!0,useFullWidthForAlignment:!0,mergeEquivalentBackgrounds:!0,inlineContentsBox:i}}doRenderLine(t,e){function n(t){if(t){if("BasicBox"===t.getModelName())return[t];{let e=[];return t.forEachContainedBox(t=>{e=e.concat(n(t))}),e}}return[]}const{node:s,elements:o}=e,i=[],r=e.boxCache||new at.a,a=new at.a,c=this.editor&&this.editor.view.focused&&this.editor.getCursor();this.cursorBox&&(this.cursorBox.onCursorLeaveAfterRenderAtCursor(),this.cursorBox=null),o.forEach(t=>{const s=t.cacheKey||t.box&&t.box.cid||null,o=t.token?t.token.getClassName():null,h=t.token?t.token.lexerToken:null;let u=s&&r.unshift(s);if(!u){let e=null,s=[];t.text?e=It(t.text,t):t.href?e={head:"PaneBox",args:[e=Object(lt.b)(t.hyperlinkText,t.href)]}:t.box?s=[u=rt.c.create("PaneBox",{head:"PaneBox",args:[]},{child:t.box,extraClassName:"editor-inset"})]:t.image||t.node,!u&&e&&(s=n(u=rt.c.fromExpr(e))),l.a.each(s,(e,n)=>{e.trackDims(t.trackDimensions,t),e.setTokenType(t.token&&t.token.type||null)}),u&&(u.setEditorBox(),u.editorToken=t.token,u.lexerToken=h)}const d=u;d&&(t.text&&(d.off("replace"),d.on("replace",n=>{const s=this.editor&&this.editor.lineInfo(e);if(s){const e=s.line,o={line:e,ch:t.from},i={line:e,ch:t.to};this.replaceData(n,o,i),this.focus()}}),c&&t.from<=c.ch&&c.ch<t.to&&(this.cursorBox=d,this.cursorBox.onRenderAtCursor())),d.setExtraClassName(o||""),d.token=t.token,t.changeStyle=(t=>{d.setExtraClassName(t),d.forceRender()}),t.addExtraClassName=(t=>{d.addExtraClassName(t),d.forceRender()}),t.removeExtraClassName=(t=>{d.removeExtraClassName(t),d.forceRender()}),i.push(d),a.push(s,d))}),e.boxCache=a;let h=e.box;h?h.set("children",i):((h=e.box=rt.c.create("RowBox",{head:"RowBox",args:[{head:"List",args:[]}]},{children:i})).setEditorBox(),h.onPersistentChange=(t=>{this.clearContentCaches(),this.signalChange(t)}));let u=!0,d=e.layout,p={};d?d.setBox(h):(d=e.layout=h.mountIntoNode(s,{onReflow:t=>{const n=t.width!==p.width||t.height!==p.height||t.baseline!==p.baseline;p=t,!u&&n&&(this.editor&&this.editor.reflow([e]),this.forceRender())}}),y.a.on(e,"delete",this.unmountLine.bind(this,e)));const f=this.getModifiedContext();p=d.reflow(this.getRenderOptions(t,e),{context:f}),u=!1;const g=p.trackedItems;return e.indentationBelow=p.indentation||0,[p,g||[]]}reflowLine(t,e){const{layout:n}=e;if(n){const s=this.getModifiedContext(),o=n.reflow(this.getRenderOptions(t,e),{context:s}),i=o.trackedItems;return e.indentationBelow=o.indentation||0,[o,i||[]]}return this.doRenderLine(t,e)}unmountLine(t){t.layout&&(t.box&&(t.box.onPersistentChange=null,t.box=null),t.layout.unmount(),t.layout=null),y.a.off(t,"delete")}onRender(t){this.forceRender({notDuringRender:!0})}getPrepareContextModifications(){return{editor:this}}onAppear(){this.editor&&this.didLinesUnmount&&(this.editor.reflow(),this.didLinesUnmount=!1)}onDisappear(){this.editor&&(this.editor.iterLines(t=>{this.unmountLine(t)}),this.didLinesUnmount=!0)}onCachedRender(t){if(!this.editor)return;const e=this.maxWidth;t.renderArgWidth!==e&&this.editor.reflow()}getMaxRenderCacheSize(){return 0}doRender(t,e){let{width:n,native:s,placeholder:o,inlineContentsBox:i}=t,{processedContent:r,symdata:a}=e;if(s||this.readOnly&&nt(r)){return this.get("content").renderWrapped(n,{native:s,contentPadding:!0,useFullWidthForAlignment:!0,isRequired:!0,inlineContentsBox:i})}const c=this.inlineContentsBox!==i;this.inlineContentsBox=i;const u=this.maxWidth!==n||l.a.isNaN(n)||c;if(this.maxWidth=n,this.editor){if(r!==this.processedContent){const t=this.getSelection(),{text:e,markers:n}=r;this.isExternalChange=!0,this.editor.setValue(e),this.editor.addMarkers(n),this.setSelection(t),this.isExternalChange=!1}u&&this.editor.reflow()}else this.createCodeMirror(r,a);const d=this.editor;this.setDuringRender("content",null),this.processedContent=r,this._checkLinesRenderedCompletely();const p=d.getDimensions();if(o&&this.isEmpty()){if(!this.placeholderNode){const t=d.display.lineSpace;this.placeholderNode=document.createElement("div"),this.placeholderNode.style.height="0",this.placeholderNode.style.overflow="visible",t.insertBefore(this.placeholderNode,t.firstChild)}m.a.render(o.node,this.placeholderNode),p.width=Math.max(p.width,o.width),p.height=Math.max(p.height,o.height),p.baseline=Math.max(p.baseline,o.baseline)}else this.placeholderNode&&(m.a.unmountComponentAtNode(this.placeholderNode),h()(this.placeholderNode).remove(),this.placeholderNode=null);return{node:f.createElement(gt.a,{node:this.container,onMount:this.options.onMount}),width:p.width,height:p.height,baseline:p.baseline,renderArgWidth:n}}_checkLinesRenderedCompletely(){const t=[];if(d()(this.editor),this.editor.iterLines(e=>{const n=e.box;n.isRenderedCompletely()&&e.layout&&!e.layout.whenMounted().isPending()||t.push(n.whenRenderedCompletely().then(()=>e.layout.whenMounted()))}),t.length)throw Y.a.all(t).then(()=>{this.forceRender()}),this.pending()}_setContentAssist(t){this.contentAssist=t,this.notebook&&this.notebook.setContentAssist(t)}setOptions(t){if(!this.editor)return;const e=this.editor,{autocomplete:n,isMathematicaCode:s,readOnly:o}=t;void 0!==o&&o!==this.readOnly&&(e.setOption("readOnly",o),this.readOnly=o),void 0!==n&&n!==this.options.autocomplete&&(e.setOption("autocomplete",n),this.options.autocomplete=n,this._setContentAssist(null),n&&St().then(t=>{this._setContentAssist(t)}).then(()=>{d()(this.contentAssist),s?this.contentAssist.enableTooltips(this):this.contentAssist.disableTooltips(this)})),void 0!==s&&s!==this.isMathematicaCode&&(this.isMathematicaCode=s,e.setOption("mode",s?"mathematica":"mathematica-text"),e.removeKeyMap(this.mathematicaKeys),e.removeKeyMap(this.textKeys),e.addKeyMap(s?this.mathematicaKeys:this.textKeys),e.setOption("mathematicaMatchBrackets",s),e.setOption("theme",s?"mathematica":"text"))}signalChange(t){const e=this.options.onChange;e&&window.setTimeout(()=>e(this,t),0)}refresh(){this.editor&&this.editor.refresh()}canInsertAssistant(t){let{requireCodeMode:e}=t;if(this.notebook&&this.cell){const t=this.cell.isEditable(),n=!e||this.isMathematicaCode,{activeElement:s}=document,o=s&&s.hasAttribute("data-input-assistant");if(t&&n&&!o)return!0}return!1}insertCtrlEqual(){this.insertLinguisticBox({requireCodeMode:!0})}insertLinguisticBox(t){if(this.canInsertAssistant(t)&&this.editor){const t=this.editor,e=t.getSelectedMarks().length>0?"":this.getSelectedText(),n=this.getContextHeadBox(),s=n&&n.getModelName(),o="LinguisticBox"===s||"TemplateBox"===s,i=this.getContext(),r=ot.expression("CloudSystem`InsertLinguisticBox",[ot.string(e),o]),a=i.evaluate({input:r,context:i}),l=rt.c.create("LinguisticBox",it.nc,{insertionEvaluation:a,query:e});return l.onPersistentChange=(()=>{const{onChange:t}=this.options;t&&t(this)}),t.cancelAutoFocus(),this.insertBoxAtCursor(l)}return Y.a.reject()}insertSimpleInputAssistantBox(t,e){if(this.canInsertAssistant(e)&&this.editor){const e=this.editor,n=e.getSelectedMarks().length>0?"":this.getSelectedText(),s=this.getContext(),o=ot.expression("ToBoxes",[ot.expression("CloudSystem`Private`".concat(t,"Assistant"),[ot.string(n)])]),i=s.evaluate({input:o}),r=rt.c.create("".concat(t,"Box"),it.nc,{input:n,insertionEvaluation:i});r.onPersistentChange=(()=>{const{onChange:t}=this.options;t&&t(this)}),e.cancelAutoFocus(),this.insertBoxAtCursor(r)}}handleKeydown(t){let{ctrlKey:e,shiftKey:n,text:s}=t;return e&&"="===s?(this.insertLinguisticBox({requireCodeMode:!0}),!0):!(!e||!n||"1"!==s)&&(this.insertSimpleInputAssistantBox("InputForm",{requireCodeMode:!0}),!0)}handleKeypress(t,e){}keydown(t){return!!this.handleKeydown(t)}keypress(t,e){if(this.handleKeypress(t,e))return!0;let n=!1;return this.options.onKeyPress&&this.options.onKeyPress.call(this,{type:"keypress",which:t.charCodeAt(0),shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,stop:function(){n=!0}}),n||this.insertTextAtCursor(t),n}cursorCoords(){if(!this.editor)return{left:0,top:0,bottom:0};const t=this.editor,e=t.getCursor("head");return t.cursorCoords(e,"page")}selectCoords(t){if(!this.editor)return;const e=this.editor,n=e.coordsChar({left:t.x,top:t.y});e.setCursor(n),this.focus()}onReceiveContext(){if(this.container&&this.container.classList){this.getContext().get("isSessionKernel")?this.container.classList.add("session-kernel"):this.container.classList.remove("session-kernel")}this.editor&&this.editor.refresh()}firstLine(){return 0}lastLine(){return this.editor?this.editor.lineCount()-1:0}focus(){this.editor&&this.editor.focus(!0)}blur(){if(!ht.a("ignoreEditorBlur")&&this.editor){const t=this.editor;t.somethingSelected()&&t.setCursor(t.getCursor("head")),t.blur()}}isFocused(){return this.editor&&this.editor.isFocused()}selectLines(t,e,n,s){if(!this.editor)return;const o=this.editor;void 0!==s?o.setSelection({line:t||0,ch:e},{line:n||0,ch:s}):o.setCursor({line:t||0,ch:e})}getStart(){return Pt(this.editor,!0).start}getEnd(){return Pt(this.editor,!0).end}dispatchDOMEvent(t){const e=this.editor;e&&e.display&&e.display.scroller&&e.display.scroller.dispatchEvent(t)}isReadyToReceiveInput(){return this.editor}isStartSelected(){const t=this.getStart(),e=Pt(this.editor);return!P.a.cmpPos(t,e.start)&&!P.a.cmpPos(t,e.end)}isEndSelected(){const t=this.getEnd(),e=Pt(this.editor);return!P.a.cmpPos(t,e.start)&&!P.a.cmpPos(t,e.end)}selectAll(){this.editor&&this.editor.selectAll()}selectStart(){if(!this.editor)return;const t=this.editor;t.focus(),t.setCursor({line:0,ch:0})}selectEnd(){if(!this.editor)return;const t=this.editor;t.focus(),t.setCursor({line:t.lineCount()+1,ch:0})}selectStartOfLastLine(){if(!this.editor)return;const t=this.editor;t.focus();const e=t.charCoords({line:t.lineCount()+1,ch:0}),n=t.coordsChar({left:0,top:e.bottom-3});t.setCursor(n)}selectNextTemplate(t,e,n,s){const o=this.editor,i=Pt(o,!0),r=s||{line:0,ch:0};Wt(o,t,e||i.start,n||i.end,r,r)}tabKeyPress(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Pt(t),s=Pt(t,!0);Wt(t,e,s.start,s.end,n.start,n.end)}afterChange(t){this.clearContentCaches(),this.options.onChange&&!this.isExternalChange&&this.options.onChange(this,t)}isBoxMarker(t,e){const n=t.boxOptions;return!!n&&n.boxName===e}applySelectionBox(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!this.editor)return;const o=this.editor,i=Pt(o,t);Bt(o,i.start,i.end,(t,r,a,c)=>{if(t.boxOptions){const h=t.boxOptions,u=h.boxName,d=h.options,p=h.styleNames;if(u===e){const u={};l.a.each(n,(t,e)=>{d&&d[e]&&(u[e]=d[e],delete d[e])});const f=l.a.intersection(s,p);if(f.length&&(h.styleNames=l.a.difference(p,s)),l.a.isEmpty(h.options)&&l.a.isEmpty(h.styleNames)&&t.clear(),!l.a.isEmpty(u)||f.length){const t=Lt({start:{line:c,ch:r},end:{line:c,ch:a}},i),n={boxOptions:{boxName:e,options:u,styleNames:f}};Et(n),t.forEach(t=>{o.markText(t.start,t.end,n)})}}}});const r={boxOptions:{boxName:e,options:n,styleNames:s}};Et(r),o.markText(i.start,i.end,r),this.afterChange()}clearEditBoxes(t,e){const n=this,s=Pt(this.editor,e);Bt(this.editor,s.start,s.end,e=>{n.isBoxMarker(e,t)&&e.clear()}),this.afterChange()}clearFormatting(t){this.clearEditBoxes("StyleBox",t)}getSelection(){return Pt(this.editor)}setSelection(t){this.editor&&this.editor.setSelection(t.start,t.end)}replaceData(t,e,n,s){let o=e,i=n;if(!e||!n){const t=Pt(this.editor,!0);e||(o=t.start),n||(i=t.end)}return Tt(this.editor,t,o,i,this,s)}setBox(t){this.setState({content:t})}setTextValue(t){this.setBox(ot.string(t))}insertBoxAtCursor(t){const e=t instanceof rt.c?t:ot.expression(t),n=Pt(this.editor);return Tt(this.editor,e,n.start,n.end,this)}insertTextAtCursor(t){return this.editor&&this.editor.replaceSelection(t,"end")}getEvaluateInPlaceInfo(){if(!this.editor)return Y.a.resolve(null);const{start:t,end:e}=Pt(this.editor,!1);return this.serialize({isForServer:!0,isBoxData:!0},t,e).then(t=>({contentMExpr:t})).catch(t=>(wt.debug("Error encountered when getting serialized content",t),null))}replaceContentForCurrentRange(t){if(!this.editor)return;const e=this.editor,{start:n,end:s}=Pt(e,!1);this.replaceData(t,n,s,"eval-in-place-edit").then(t=>{setTimeout(()=>{this.focus(),e.setCursor(t)},0),this.signalChange({shouldGrayDownCells:!1})})}getCopyData(t){const e=Pt(this.editor,t);return Y.a.all([this.toPlainText(e.start,e.end),this.serialize({isForServer:!1,isBoxData:!0},e.start,e.end)]).then(t=>{let[e,n]=t;return{expr:n,text:e,cut:()=>this.deleteSelectedText()}})}pasteData(t){function*e(t){let n=[];t.hasHead("Notebook")&&t.size()>0&&t.part(1).hasHead("List")?n=t.part(1).parts():t.hasHead("Cell")&&t.size()>0&&t.part(1).hasHead("CellGroupData")?n=t.part(1).part(1).parts():t.hasHead("Cell")&&t.size()>0&&(yield t);for(const t of n)yield*e(t)}const n=Pt(this.editor);let s=null;const o=t.expr;if(o)if(o.hasHead("Notebook")||o.hasHead("Cell")){const t=[];for(const n of e(o)){const{data:e}=Object(vt.a)(n.part(1));for(const n of e)t.length&&t.push(ot.string("\n\n")),t.push(n)}s=ot.expression("RowBox",[ot.expression("List",t)])}else s=o;else t.text?s=ot.string(t.text):t.image&&(s=Object(ut.a)(t.image));return Y.a.resolve(s).then(t=>{if(!t)throw new Error("No content to paste");return rt.c.fromExpr(t)}).then(t=>Tt(this.editor,t,n.start,n.end,this)).then(t=>{this.editor&&this.editor.setCursor(t)}).catch(t=>{wt.warn("Cannot paste",t)}),!0}isEmpty(){function t(t){return ot.isExpr(t)&&t.sameQ(it.nc)}if(this.editor){const t=this.editor;return 1===t.lineCount()&&""===t.getLine(0)}{const e=this.get("content");return!e||t(e)||e instanceof rt.c&&t(e.expr)}}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.getEditorContentsMExpr(t,e,n).then(t=>{let e;return e=1===t.length?t[0]:{head:"RowBox",args:[{head:"List",args:t}]},ot.fromData(e)})}toPlainText(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{pureText:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.editor){const t=this.state.content;if(t instanceof rt.c)return t.toPlainText()}const s=[],o=Pt(this.editor,!0);return t&&(o.start=t),e&&(o.end=e),Kt(this.editor,o.start,o.end,(t,e,i,r,a)=>{if(t.text){let e=Mt(t.text,a,t.from,t.to,o);e=Object(K.f)(e),s.push(e)}else t.box&&s.push(t.box.toPlainText({pureText:n}))},t=>{t||s.push("\n")}),Object(dt.a)(s)}clearContentCaches(){this.serialize.clearCache(this),this.toPlainText.clearCache(this)}getBoxPosition(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=Pt(this.editor,!0);let o=null;return e&&(s.start=e),n&&(s.end=n),Kt(this.editor,s.start,s.end,(e,n,s,i,r)=>e.box!==t||(o={chStart:e.from,chEnd:e.to,line:i,lineNo:r},!1)),o}getEditorContents(t,e){return this.getEditorContentsMExpr({isForServer:!0,isBoxData:!0},t,e)}getEditorContentsMExpr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.editor){const t=this.get("content");if(t instanceof rt.c)return Y.a.resolve([t.expr])}const s=Pt(this.editor,!0);e&&(s.start=e),n&&(s.end=n);const o=[];return Kt(this.editor,s.start,s.end,(e,n,i,r,a)=>{let l=null;const c=e.token;if(e.box)l=e.box.serialize(t).then(e=>{return[t.isBoxData?e:ot.expression(it.u,[ot.expression(it.n,[e])]),c]});else if(e.text){const t=It(Mt(e.text,a,e.from,e.to,s),e);l=Y.a.resolve([t,c])}l&&o.push(l)},t=>{if(!t){const t=ot.string("\n");o.push(Y.a.resolve([t,null]))}}),Y.a.all(o).then(t=>{const e=[];let n=null,s=!1,o=null,i=null;return t.forEach(t=>{let[r,a]=t;if(!r)return;const l=a?a.type:null,c="message-name-part"===l;if(a&&a.partOfString||!a&&o){let t=r.toStringValue();t||(t=Object(pt.c)(r)),o?o.push(t):(o=[t],e.push({isStringParts:!0,parts:o})),a&&a.endOfString&&(o=null)}else if(c)if(i)i.push(r);else{const t=e.pop();i=t instanceof xt.a?[t,r]:[r],e.push({isMessageName:!0,args:i})}else{let t=!1;if(n&&e.length){const o=e[e.length-1];if(a&&"string"===l&&"string"===n.type||s){if(r instanceof yt.a&&o instanceof yt.a){const n=ot.string(o.toStringValue()+r.toStringValue());e.pop(),e.push(n),t=!0}}else if(a===n&&"comment"!==l&&"space"!==l){if(o.isTokenStyleBox)o.args.push(r);else{e.pop();const t=o instanceof xt.a?[o,r]:[r];e.push({isTokenStyleBox:!0,args:t})}t=!0}}if(!t){const t=r.toStringValue();!t||"<<"!==t&&">>"!==t&&">>>"!==t&&"??"!==t&&"?"!==t||(s=!0),e.push(r)}}c||(i=null),n=a}),e.map(t=>t.isStringParts?ot.string(t.parts.join("")):t.isMessageName?ot.expression("RowBox",[ot.expression("List",t.args)]):t.isTokenStyleBox?ot.expression("StyleBox",[ot.expression("RowBox",[ot.expression("List",t.args)])]):t)})}getContextHeadBox(){if(!this.editor)return null;const t=this.editor,e=t.getCursor(),{expr:n,start:s,token:o}=e&&t.getTokenAtWithoutState(e)||{},i=n&&n.head&&n.head.token;if(o&&i){const e={ch:i.pos,line:t.getLineNumber(i.line)},n={ch:s,line:t.getLineNumber(o.line)},[r]=this.getEditorContentBoxes(e,n)||[];return r}return null}getEnclosingBox(){let{funcExpr:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.editor;if(!e)return null;const n=t&&t.head&&t.head.token;if(n){const{content:t,line:s,pos:o}=n,i=e.getLineNumber(s),r={ch:o,line:i},a={ch:o+t.length,line:i},[l]=this.getEditorContentBoxes(r,a);return l||null}return null}getEditorContentBoxes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[],s=Pt(this.editor,!0);return t&&(s.start=t),e&&(s.end=e),Kt(this.editor,s.start,s.end,(t,e,s,o,i)=>{t.box&&n.push(t.box)}),n}getSelectedTextProp(t){const e=[],n=Pt(this.editor,!1);return Bt(this.editor,n.start,n.end,n=>{n[t]&&e.push(n[t])}),e}getSelectedBoxOptions(t,e){const n=Pt(this.editor);return Dt(this.editor,n.start,n.end,t,e)}getSelectedText(){return this.editor?this.editor.getSelection():""}getCompletionNeedle(t){if(!this.editor)return null;const e=this.editor.getCursor();return V.a(this,e,t)}insertAtCursor(t){if(!this.editor)return;const e=this.editor;e.replaceSelection(t);const n=e.getCursor("head");e.setSelection(n)}deleteSelectedText(){this.editor&&this.editor.replaceSelection("")}testSimulateTyping(){function t(t){const e=t.toUpperCase().charCodeAt(0);return{36:52,38:55}[e]||e}if(!this.editor)return;const e=this.editor,n=e.display.input;let s;for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];for(s=0;s<i.length;++s){const o=i[s];if("string"==typeof o)for(let s=0;s<o.length;++s){const i=o.charAt(s),r=o.charCodeAt(s),a=t(i),l={charCode:r,keyCode:a,which:a,altKey:!1,ctrlKey:!1,shiftKey:!1,altGraphKey:!1,metaKey:!1};e.triggerEvent("keydown",l),e.triggerEvent("keypress",l),n.value=(n.value||"")+o.charAt(s),e.triggerEvent("keyup",l)}else if(o.shortcut){const t=P.a.parseKeyboardEvent(o.shortcut);e.triggerEvent("keydown",t),e.triggerEvent("keyup",t)}else wt.warn("Unknown typing specifier:",o);e.flushInput()}}},r()(bt.prototype,"serialize",[Ct],Object.getOwnPropertyDescriptor(bt.prototype,"serialize"),bt.prototype),r()(bt.prototype,"toPlainText",[kt],Object.getOwnPropertyDescriptor(bt.prototype,"toPlainText"),bt.prototype),bt)},a7Cy1t:function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"b",function(){return l});
/* @license
 *
 * The MIT License (MIT)
 *
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
const s="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}",o="[0-9a-fA-F]{1,4}",i="\n(?:".concat(o,":){1,4}:").concat(s,"|             // 2001:db8:3:4::192.0.2.33  64:ff9b::192.0.2.33\n::(?:ffff(?::0{1,4}){0,1}:){0,1}").concat(s,"|     // ::255.255.255.255  ::ffff:255.255.255.255  ::ffff:0:255.255.255.255\nfe80:(?::").concat(o,"){0,4}%[0-9a-zA-Z]{1,}|   // fe80::7:8%eth0     fe80::7:8%1\n(?:").concat(o,":){7,7}").concat(o,"|           // 1:2:3:4:5:6:7:8\n:(?:(?::").concat(o,"){1,7}|:)|                 // ::2:3:4:5:6:7:8    ::2:3:4:5:6:7:8  ::8\n").concat(o,":(?:(?::").concat(o,"){1,6})|      // 1::3:4:5:6:7:8     1::3:4:5:6:7:8   1::8\n(?:").concat(o,":){1,2}(?::").concat(o,"){1,5}| // 1::4:5:6:7:8       1:2::4:5:6:7:8   1:2::8\n(?:").concat(o,":){1,3}(?::").concat(o,"){1,4}| // 1::5:6:7:8         1:2:3::5:6:7:8   1:2:3::8\n(?:").concat(o,":){1,4}(?::").concat(o,"){1,3}| // 1::6:7:8           1:2:3:4::6:7:8   1:2:3:4::8\n(?:").concat(o,":){1,5}(?::").concat(o,"){1,2}| // 1::7:8             1:2:3:4:5::7:8   1:2:3:4:5::8\n(?:").concat(o,":){1,6}:").concat(o,"|          // 1::8               1:2:3:4:5:6::8   1:2:3:4:5:6::8\n(?:").concat(o,":){1,7}:|                       // 1::                                 1:2:3:4:5:6:7::\n::                                              // ::\n").replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),r=t=>t&&t.exact?new RegExp("(?:^".concat(s,"$)|(?:^").concat(i,"$)")):new RegExp("(?:".concat(s,")|(?:").concat(i,")"),"g");
/* @license
 *
 * The MIT License (MIT)
 *
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function a(){let{matchStart:t,matchEnd:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=e?"$":"",s="[^\\.\\s@][^\\s@]*(?!\\.)@[^\\.\\s@]+(?:\\.[^\\.\\s@]+)*";return new RegExp("".concat(t?"^":"").concat(s).concat(n),"ig")}
/* @license
 *
 * The MIT License (MIT)
 *
 * Copyright (c) Kevin Mårtensson <kevinmartensson@gmail.com> and Diego Perini
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function l(){let{matchStart:t,matchEnd:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t?"^":"",s=e?"$":"",o="(?:(?:[a-z]+:)?//)",i="(?:\\S+(?::\\S*)?@)?",a=r.v4().source,l="(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)",c="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",h="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?",u="(?::\\d{2,5})?",d='(?:[/?#][^\\s"]*)?',p="(?:".concat(o,"|www\\.)").concat(i,"(?:localhost|").concat(a,"|").concat(l).concat(c).concat(h,")").concat(u).concat(d);return new RegExp("".concat(n).concat(p).concat(s),"ig")}r.v4=(t=>t&&t.exact?new RegExp("^".concat(s,"$")):new RegExp(s,"g")),r.v6=(t=>t&&t.exact?new RegExp("^".concat(i,"$")):new RegExp(i,"g"))},fpt3M3:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var s=n("+PQVfF"),o=n("MFYXOd");function i(t,e,n){let{editor:i}=t,{line:l,ch:c}=e;const h=new o.a(i,l,c),u=!h.right(),d=h.left();if(d){const{content:t,pos:e,type:o}=d,i=c-e<t.length?t.substr(0,c-e):t;if("bracket-left"===o&&n){const{last:t}=h.leftWhile(a,{last:null});if(t)return{eol:u,line:t.startPos.line,needle:t.content+i,start:t.startPos.ch,token:t}}else{if("char-esc"===o||"identifier"===o){const t=h.left();if(t){const e="char-esc"===o?s.f:"\\[",{content:n,startPos:r,type:a}=t;if("operator-prefix"===a&&n===e)return{eol:u,line:r.line,needle:n+i,start:r.ch,token:d}}return{eol:u,line:l,needle:i,start:e,token:d}}if("string"===o){const{contents:t,last:e}=h.leftWhile(r,{contents:i,last:d}),{startPos:n}=e;return{eol:u,line:n.line,needle:t,start:n.ch,token:e}}}}return null}function r(t,e){return!!t.partOfString&&(e.contents=t.content+e.contents,e.last=t,!t.startOfString)}function a(t,e){return e.last=t,"space"===t.type}},"q9a/O4":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i});var s=n("GDye+G");const o=s.fromCompactData(["RawBoxes",["DynamicBox",["FEPrivate`FrontEndResource",'"FEExpressions"','"MessageMenuIcon"']]]);function i(t,e){const n=s.escapedString(s.escapedString(t)),o=s.escapedString(e);return{head:"TagBox",args:[{head:"ButtonBox",args:[{head:"PaneSelectorBox",args:[{head:"List",args:[{head:"Rule",args:["False",n]},{head:"Rule",args:["True",{head:"StyleBox",args:[n,{head:"List",args:['"HyperlinkActive"']}]}]}]},{head:"Dynamic",args:["True"]},{head:"Rule",args:["BaseStyle",{head:"List",args:['"Hyperlink"']}]},{head:"Rule",args:["FrameMargins",0]},{head:"Rule",args:["ImageSize","Automatic"]}]},{head:"Rule",args:["BaseStyle",'"Hyperlink"']},{head:"RuleDelayed",args:["ButtonData",{head:"List",args:[o,"None"]}]},{head:"Rule",args:["ButtonNote",o]}]},{head:"Function",args:[{head:"Annotation",args:[{head:"Slot",args:[1]},o,'"Hyperlink"']}]}]}}},qGwtCP:function(t,e,n){"use strict";function s(){this.data={}}n.d(e,"a",function(){return s}),s.prototype={push:function(t,e){if(void 0===t)return;const n=this.data[t];if(n){n._last._next=e,e._next=null,n._last=e}else this.data[t]=e,e._next=null,e._last=e},unshift:function(t){const e=this.data[t];if(e){const n=this.data[t]=e._next;return n&&(n._last=e._last!==e?e._last:null),e}return null},each:function(t,e){let n=this.data[t],s=0;for(;n;)e(n,s),++s,n=n._next},remove:function(t,e){const n=(e,n,s)=>{if(n)n._next=e._next,e._next||(s._last=n);else{const n=this.data[t]=e._next;n&&(n._last=s._last)}},s=this.data[t];let o=s,i=null;for(;o;)!e||e(o)?n(o,i,s):i=o,o=o._next},list:function(t){const e=[];return this.each(t,t=>{e.push(t)}),e},hasItems:function(t){return!!this.data[t]}}}}]);